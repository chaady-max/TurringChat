<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TurringChat - Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Login Form */
        .login-form {
            padding: 40px;
        }

        .login-form h2 {
            color: #667eea;
            margin-bottom: 24px;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
        }

        .error {
            color: #e74c3c;
            margin-top: 12px;
            font-size: 14px;
        }

        /* Dashboard */
        .dashboard {
            padding: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            font-weight: 500;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: 700;
        }

        .section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .section h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 6px;
            overflow: hidden;
        }

        .table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .table td {
            padding: 12px;
            border-bottom: 1px solid #e1e8ed;
            font-size: 14px;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .refresh-btn:hover {
            background: #5568d3;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginSection">
            <div class="login-form">
                <h2>Admin Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="login-btn">Login</button>
                    <div id="loginError" class="error"></div>
                </form>
                <p style="margin-top: 20px; color: #6c757d; font-size: 12px;">
                    Default credentials: <code>admin</code> / <code>admin123</code><br>
                    Change credentials via <code>ADMIN_USERNAME</code> and <code>ADMIN_PASSWORD_HASH</code> environment variables.
                </p>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboardSection" class="hidden">
            <div class="header">
                <h1>TurringChat Admin Dashboard</h1>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <div class="dashboard">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Players in Pool</h3>
                        <div class="value" id="poolCount">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending Matches</h3>
                        <div class="value" id="pendingCount">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Active Games</h3>
                        <div class="value" id="activeCount">0</div>
                    </div>
                </div>

                <!-- Pending Requests -->
                <div class="section">
                    <h2>Pending Match Requests</h2>
                    <button class="refresh-btn" onclick="loadStats()">Refresh</button>
                    <div id="pendingRequests"></div>
                </div>

                <!-- Active Pairs -->
                <div class="section">
                    <h2>Active Game Pairs</h2>
                    <div id="activePairs"></div>
                </div>

                <!-- Pool Info -->
                <div class="section">
                    <h2>Player Pool</h2>
                    <div id="poolInfo"></div>
                </div>

                <!-- OpenAI Usage Statistics -->
                <div class="section">
                    <h2>OpenAI API Usage</h2>
                    <p style="margin-bottom: 12px; color: #6c757d; font-size: 14px;">
                        Monitor token usage, costs, and API call statistics.
                    </p>
                    <button class="refresh-btn" onclick="loadUsageStats()">Refresh Usage</button>
                    <div id="usageStats" style="margin-top: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                            <div class="stat-card">
                                <div class="stat-label">Total Calls</div>
                                <div class="stat-value" id="totalCalls">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total Tokens</div>
                                <div class="stat-value" id="totalTokens">-</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total Cost</div>
                                <div class="stat-value" id="totalCost">$0.00</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Avg Response Time</div>
                                <div class="stat-value" id="avgResponseTime">-</div>
                            </div>
                        </div>
                        <div>
                            <h3 style="font-size: 16px; margin-bottom: 12px; color: #333;">Usage by Model</h3>
                            <div id="modelBreakdown"></div>
                        </div>
                        <div style="margin-top: 20px;">
                            <h3 style="font-size: 16px; margin-bottom: 12px; color: #333;">Recent API Calls</h3>
                            <div id="recentCalls"></div>
                        </div>
                    </div>
                </div>

                <!-- Conversation Logs -->
                <div class="section">
                    <h2>Conversation Logs</h2>
                    <p style="margin-bottom: 12px; color: #6c757d; font-size: 14px;">
                        Click on a session to view the full conversation and analyze trick questions for AI improvement.
                    </p>
                    <button class="refresh-btn" onclick="loadSessions()">Refresh Logs</button>
                    <div id="sessionsList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Detail Modal -->
    <div id="sessionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; overflow: auto;">
        <div style="background: white; margin: 50px auto; max-width: 900px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <div style="padding: 20px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; color: #333;">Conversation Details</h2>
                <button onclick="closeSessionModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6c757d;">&times;</button>
            </div>
            <div id="sessionDetail" style="padding: 20px; max-height: 70vh; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        let authToken = localStorage.getItem('adminToken');

        // Check if already logged in
        if (authToken) {
            verifyToken();
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');

            try {
                const response = await fetch('/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.access_token;
                    localStorage.setItem('adminToken', authToken);
                    showDashboard();
                } else {
                    errorDiv.textContent = 'Invalid credentials';
                }
            } catch (error) {
                errorDiv.textContent = 'Login failed: ' + error.message;
            }
        });

        async function verifyToken() {
            try {
                const response = await fetch('/admin/verify', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    showDashboard();
                } else {
                    logout();
                }
            } catch (error) {
                logout();
            }
        }

        function showDashboard() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            loadStats();
            // Auto-refresh every 5 seconds
            setInterval(loadStats, 5000);
        }

        function logout() {
            authToken = null;
            localStorage.removeItem('adminToken');
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
        }

        async function loadStats() {
            if (!authToken) return;

            try {
                const response = await fetch('/admin/stats', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        logout();
                    }
                    return;
                }

                const data = await response.json();

                // Update stats
                document.getElementById('poolCount').textContent = data.pool_count;
                document.getElementById('pendingCount').textContent = data.pending_matches;
                document.getElementById('activeCount').textContent = data.active_games;

                // Update pending requests
                renderPendingRequests(data.pending_requests);

                // Update active pairs
                renderActivePairs(data.active_pairs);

            } catch (error) {
                console.error('Failed to load stats:', error);
            }

            // Load pool info
            try {
                const response = await fetch('/admin/pool', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    renderPoolInfo(data);
                }
            } catch (error) {
                console.error('Failed to load pool info:', error);
            }
        }

        function renderPendingRequests(requests) {
            const container = document.getElementById('pendingRequests');

            if (!requests || requests.length === 0) {
                container.innerHTML = '<div class="empty-state">No pending requests</div>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Ticket</th>
                            <th>Status</th>
                            <th>Token</th>
                            <th>Created</th>
                            <th>Expires</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${requests.map(req => `
                            <tr>
                                <td><code>${req.ticket.substring(0, 8)}...</code></td>
                                <td><span class="badge ${getStatusClass(req.status)}">${req.status}</span></td>
                                <td><code>${req.token ? req.token.substring(0, 8) + '...' : 'N/A'}</code></td>
                                <td>${new Date(req.created_at * 1000).toLocaleTimeString()}</td>
                                <td>${new Date(req.expires_at * 1000).toLocaleTimeString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function renderActivePairs(pairs) {
            const container = document.getElementById('activePairs');

            if (!pairs || pairs.length === 0) {
                container.innerHTML = '<div class="empty-state">No active game pairs</div>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Pair ID</th>
                            <th>Player A</th>
                            <th>Player B</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${pairs.map(pair => `
                            <tr>
                                <td><code>${pair.pair_id.substring(0, 8)}...</code></td>
                                <td><code>${pair.a_ticket.substring(0, 8)}...</code></td>
                                <td><code>${pair.b_ticket.substring(0, 8)}...</code></td>
                                <td>
                                    <span class="badge ${pair.a_connected && pair.b_connected ? 'badge-success' : 'badge-warning'}">
                                        ${pair.a_connected && pair.b_connected ? 'Both Connected' : 'Waiting'}
                                    </span>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function renderPoolInfo(data) {
            const container = document.getElementById('poolInfo');

            if (!data.tokens || data.tokens.length === 0) {
                container.innerHTML = '<div class="empty-state">No players in pool</div>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Player Token</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.tokens.map(token => `
                            <tr>
                                <td><code>${token}</code></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function getStatusClass(status) {
            switch (status) {
                case 'ready_ai':
                case 'ready_h2h':
                    return 'badge-success';
                case 'pending':
                    return 'badge-warning';
                case 'canceled':
                    return 'badge-danger';
                default:
                    return 'badge-info';
            }
        }

        // OpenAI Usage Functions
        async function loadUsageStats() {
            if (!authToken) return;

            try {
                // Load summary
                const summaryResponse = await fetch('/admin/usage/summary', {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                const summary = await summaryResponse.json();

                // Load recent calls
                const recentResponse = await fetch('/admin/usage/recent?limit=10', {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                const recentData = await recentResponse.json();

                renderUsageStats(summary, recentData.recent_calls || []);
            } catch (error) {
                console.error('Failed to load usage stats:', error);
                document.getElementById('usageStats').innerHTML =
                    '<div class="empty-state">Failed to load usage statistics</div>';
            }
        }

        function renderUsageStats(summary, recentCalls) {
            // Update summary cards
            document.getElementById('totalCalls').textContent =
                summary.total_calls?.toLocaleString() || '0';
            document.getElementById('totalTokens').textContent =
                summary.total_tokens?.toLocaleString() || '0';
            document.getElementById('totalCost').textContent =
                '$' + (summary.total_cost?.toFixed(4) || '0.00');

            // Calculate average response time from recent calls
            if (recentCalls.length > 0) {
                const callsWithTime = recentCalls.filter(c => c.response_time);
                if (callsWithTime.length > 0) {
                    const avgTime = callsWithTime.reduce((sum, c) => sum + c.response_time, 0) / callsWithTime.length;
                    document.getElementById('avgResponseTime').textContent = avgTime.toFixed(2) + 's';
                } else {
                    document.getElementById('avgResponseTime').textContent = '-';
                }
            } else {
                document.getElementById('avgResponseTime').textContent = '-';
            }

            // Render model breakdown
            const modelBreakdown = document.getElementById('modelBreakdown');
            if (summary.by_model && Object.keys(summary.by_model).length > 0) {
                const models = Object.entries(summary.by_model);
                modelBreakdown.innerHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Calls</th>
                                <th>Tokens</th>
                                <th>Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${models.map(([model, stats]) => `
                                <tr>
                                    <td><strong>${model}</strong></td>
                                    <td>${stats.calls?.toLocaleString() || 0}</td>
                                    <td>${stats.tokens?.toLocaleString() || 0}</td>
                                    <td>$${stats.cost?.toFixed(4) || '0.00'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                modelBreakdown.innerHTML = '<div class="empty-state">No usage data yet</div>';
            }

            // Render recent calls
            const recentCallsDiv = document.getElementById('recentCalls');
            if (recentCalls.length > 0) {
                recentCallsDiv.innerHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Model</th>
                                <th>Tokens</th>
                                <th>Cost</th>
                                <th>Response Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recentCalls.map(call => `
                                <tr>
                                    <td>${new Date(call.timestamp * 1000).toLocaleString()}</td>
                                    <td><code>${call.model}</code></td>
                                    <td>${call.total_tokens?.toLocaleString() || 0}</td>
                                    <td>$${call.total_cost?.toFixed(4) || '0.00'}</td>
                                    <td>${call.response_time ? call.response_time.toFixed(2) + 's' : '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                recentCallsDiv.innerHTML = '<div class="empty-state">No API calls yet</div>';
            }
        }

        // Conversation Logs Functions
        async function loadSessions() {
            if (!authToken) return;

            try {
                const response = await fetch('/admin/sessions?limit=20', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        logout();
                    }
                    return;
                }

                const data = await response.json();
                renderSessions(data.sessions);
            } catch (error) {
                console.error('Failed to load sessions:', error);
            }
        }

        function renderSessions(sessions) {
            const container = document.getElementById('sessionsList');

            if (!sessions || sessions.length === 0) {
                container.innerHTML = '<div class="empty-state">No conversation logs yet. Start playing to generate logs!</div>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Session ID</th>
                            <th>Started</th>
                            <th>Persona</th>
                            <th>Messages</th>
                            <th>Guess</th>
                            <th>Correct?</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sessions.map(session => `
                            <tr>
                                <td><code>${session.session_id.substring(0, 16)}...</code></td>
                                <td>${new Date(session.started_at * 1000).toLocaleString()}</td>
                                <td>${session.persona_name || 'N/A'}</td>
                                <td>${session.total_messages}</td>
                                <td>${session.player_guessed ? session.player_guessed.toUpperCase() : 'N/A'}</td>
                                <td>
                                    ${session.guess_correct !== null ? (session.guess_correct ? '<span class="badge badge-success">✓ Yes</span>' : '<span class="badge badge-danger">✗ No</span>') : '<span class="badge badge-info">N/A</span>'}
                                </td>
                                <td>
                                    <button onclick="viewSession('${session.session_id}')" style="background: #667eea; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                        View
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        async function viewSession(sessionId) {
            if (!authToken) return;

            try {
                const response = await fetch(`/admin/sessions/${sessionId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) {
                    alert('Failed to load session details');
                    return;
                }

                const session = await response.json();
                displaySessionDetail(session);
            } catch (error) {
                console.error('Failed to load session:', error);
                alert('Error loading session details');
            }
        }

        function displaySessionDetail(session) {
            const modal = document.getElementById('sessionModal');
            const detail = document.getElementById('sessionDetail');

            const messagesHtml = session.messages.map(msg => {
                const senderLabel = msg.sender === 'player' ? 'Player' : (msg.sender === 'opponent' ? 'AI' : 'System');
                const senderColor = msg.sender === 'player' ? '#667eea' : '#764ba2';
                return `
                    <div style="margin-bottom: 16px; padding: 12px; background: ${msg.sender === 'player' ? '#f0f4ff' : '#faf5ff'}; border-left: 3px solid ${senderColor}; border-radius: 4px;">
                        <div style="font-weight: 600; color: ${senderColor}; margin-bottom: 4px; font-size: 13px;">
                            ${senderLabel} <span style="color: #6c757d; font-weight: 400; font-size: 11px;">${new Date(msg.timestamp * 1000).toLocaleTimeString()}</span>
                        </div>
                        <div style="color: #333; white-space: pre-wrap;">${msg.content}</div>
                    </div>
                `;
            }).join('');

            detail.innerHTML = `
                <div style="margin-bottom: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <div>
                            <strong>Session ID:</strong><br>
                            <code style="font-size: 12px;">${session.session_id}</code>
                        </div>
                        <div>
                            <strong>Persona:</strong><br>
                            ${session.persona_name || 'N/A'}
                        </div>
                        <div>
                            <strong>Started:</strong><br>
                            ${new Date(session.started_at * 1000).toLocaleString()}
                        </div>
                        <div>
                            <strong>Duration:</strong><br>
                            ${session.ended_at ? Math.round((session.ended_at - session.started_at) / 60) + ' min' : 'N/A'}
                        </div>
                        <div>
                            <strong>Total Messages:</strong><br>
                            ${session.total_messages}
                        </div>
                        <div>
                            <strong>Outcome:</strong><br>
                            ${session.guess_correct !== null ?
                                (session.guess_correct ?
                                    '<span class="badge badge-success">Guessed Correctly ✓</span>' :
                                    '<span class="badge badge-danger">Guessed Wrong ✗</span>'
                                ) :
                                '<span class="badge badge-info">No Guess</span>'
                            }
                        </div>
                    </div>
                </div>
                <h3 style="margin-bottom: 12px; color: #333;">Conversation:</h3>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${messagesHtml}
                </div>
            `;

            modal.style.display = 'block';
        }

        function closeSessionModal() {
            document.getElementById('sessionModal').style.display = 'none';
        }

        // Load sessions on dashboard load
        function showDashboard() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            loadStats();
            loadUsageStats();  // Load OpenAI usage statistics
            loadSessions();  // Load conversation logs
            // Auto-refresh every 5 seconds
            setInterval(loadStats, 5000);
        }
    </script>
</body>
</html>
